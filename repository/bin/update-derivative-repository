#!/bin/bash

. ./repo.conf

# Steady...
[ ! -d $BINARY_TORO ] && mkdir -p $BINARY_TORO
[ ! -d $BINARY_DI_TORO ] && mkdir -p $BINARY_DI_TORO
[ ! -d $SOURCE_TORO ] && mkdir -p $SOURCE_TORO
[ ! -d $TORO_POOL ] && mkdir -p $TORO_POOL


# Ready...
for pkg in $(ls $GUADA_PACKAGES)
do
	SRC_NAME=$(dpkg --field $GUADA_PACKAGES/$pkg Source)
	[ -z "$SRC_NAME" ] && SRC_NAME=$(dpkg --field $GUADA_PACKAGES/$pkg Package)

	DEST_PKG_DIR=$TORO_POOL/$(echo $SRC_NAME | cut -c 1)/$SRC_NAME
	[ ! -d $DEST_PKG_DIR ] && mkdir -p $DEST_PKG_DIR
	
	# Create the link if already doesn't exist.
	[ ! -f $DEST_PKG_DIR/$pkg ] && ln $GUADA_PACKAGES/$pkg $DEST_PKG_DIR/$pkg
done

# Go!!!
apt-ftparchive -c apt.conf generate toro.conf 
apt-ftparchive -c apt.conf generate toro-di.conf 
apt-ftparchive -c apt.conf sources $TORO_POOL > $DIST_TORO/source/Sources
apt-ftparchive -c apt.conf release $DIST_EDGY > $DIST_EDGY/Release


# TODO: sign Relase
