#!/bin/sh

. /scripts/casper-functions

is_valid_dir () {
  test -e "/mnt/extrahooks/.version"
  return $?
}

extra_main () {
  # Checking for block devices
  if [ ! -d /mnt ]; then
    mkdir /mnt
  fi
  for dev in $(echo /dev/[sh]d[a-z]*)
    do
    fs=""
    fs=$(sudo /lib/udev/vol_id -t $dev 2> /dev/null)
    if [ -z "$fs" -o "$fs" = "swap" ]; then
      if [ ! $(mount -t $fs $dev /mnt/) ]; then
        continue
      elif [ ! is_valid_dir ];then
        umount /mnt
        continue
      fi
      do_it
      umount /mnt
    fi
  done

}
